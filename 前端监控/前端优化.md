# 性能优化

## 问题

- 什么是web性能
    - 打开速度
    - 动画效果
    - 表单提交
    - 列表滚动
    - 页面切换
    - ...

    - MDN上的web性能定义： Web性能是网站或应用程序的客观度量和可感知的用户体验


## 一、性能指标

### 1、RAIL 性能模型
RAIL 是Response, Animation. Idle 和 Load的缩写
 - 响应(response): 应该尽可能快地响应给用户，应该在100ms内响应用户输入

 - 动画(Animation)：在展示动画的时候，每一帧应该以16ms进行渲染，这样可以保持动画效果的一致性，并且避免卡顿。

 - 空闲(Idle): 当使用javascript主线程的时候，应该把任务划分到执行时间小于 50ms 的片段中去，这样可以释放线程以进行用户交互。

 - 加载(Load): 应该在小于1s的时间内加载完成你的网站，并且可以进行用户交互。

### 2、基于用户体验的性能指标
基于用户体验的性能指标是google在 web.dev 提出的
- FCP（首次内容绘制）
- LCP（最大内容绘制）
- FID（首次输入延迟）
    - 表现
        - 表单元素：文本框、复选框，当选框
        - a标签
        - 选择下拉菜单
    - 优化手段
        - 分割长任务（50ms 以上）
        - 优化您的页面，做好交互准备
            - 渐进式加载代码和功能可以有助于分散工作量，改善交互准备。
        - 使用web Worker
        - 减少JavaScript执行时间
- TTI（网页第一次完全到达可交互状态的时间点）
- TBT（总阻塞时间）
度量了FCP和TTI之间的总时间
- CLS（累计布局偏移）
- Speed Index（速度指标）


核心：
    - 加载性能：LCP
    - 交互性：FID
    - 视觉稳定性：CLS

## 二、性能测试

### 1、使用灯塔 Lighthouse 测试性能
Google开发并开源 

- 优化建议
    - 移除阻塞渲染的资源
    - 预连接所要请求的源
    - 降低服务器端响应时间
    - 适当调整图片大小
    - 移除未使用的css
- 诊断结果
    - 对静态资源文件使用高效的缓存策略
    - 减少主线程的工作
    - 降低JavaScript脚本执行时间
    - 避免存在较大尺寸网络资源的请求
    - 缩短请求深度
- 已通过的性能指标
    - 1、延迟加载首屏视窗外的图片
    - 2、压缩CSS文件
    - 3、压缩JavaScript文件
    - 4、对图片文件采用高效的编码方式
    - 5、采用新一代文件图片格式（WebP、JEPG XR、JPEG 2000）
    - 6、开启文本压缩
        - 常见压缩方式 gzip、deflate、brotli
    - 7、避免多次页面重定向
    - 8、预加载关键请求
        - 通过<link ref="preload"> 充分利用网站运行的间歇期
    - 9、使用视频格式提供动画内容
        - 通过 webM 或 MPEG4 提供动画来取代中大型的GIF动画
    - 10、避免 DOM 的规模过大
    - 11、确保在网页字体加载期间文本内容可见
        -  使用 css 的 font-display 功能

### 2、使用webpage进行性能测试
全球不同站点测试地址： www.webpagetest.org


### 3、使用 Chrome DevTools 测试性能